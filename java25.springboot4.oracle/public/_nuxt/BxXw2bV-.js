import{m as T,A as x,r as q,q as C,c as u,a as o,B as S,C as r,D as d,d as p,t as I,o as g,_ as P}from"#entry";import{$ as i}from"./BvxTx_lq.js";import{a as D}from"./ngrFHoWO.js";const $={class:"container"},U={class:"card mt-3 mb-4 border-2"},A={class:"card-body bg-warning"},N={enctype:"multipart/form-data"},E={class:"row"},B={class:"col"},F={class:"mb-3"},O={class:"mb-3"},R={class:"mb-3"},V={class:"mb-3"},j={class:"col"},L={class:"mb-3 text-left"},z=["src"],J={class:"mb-3 text-left"},G={class:"row"},K={class:"col"},Q={class:"form-check"},Y={id:"cpwd"},H={class:"mb-3"},W={class:"mb-3"},X={id:"mfa1"},Z=["src"],ee={class:"col"},se={class:"form-check"},oe={key:0},te={class:"card-footer text-danger"},ae=T({__name:"userprofile",setup(ie){const n=D.create({baseURL:"http://localhost:9090",headers:{Accept:"application/json","Content-Type":"application/json"}}),e=x({firstname:"",lastname:"",email:"",mobile:"",password:"",confpassword:"",profileMsg:"",qrcodeurl:"",profilepic:"",userId:"",token:"",showSave:!1}),f=q(null);function w(a){e.profileMsg="please wait...",n.get(`/api/getuserid/${a}`,{headers:{Authorization:`Bearer ${e.token}`}}).then(s=>{e.firstname=s.data.firstname,e.lastname=s.data.lastname,e.email=s.data.email,e.mobile=s.data.mobile,e.profilepic=`http://localhost:9090/users/${s.data.userpic}`,s.data.qrcodeurl!==null?e.qrcodeurl=s.data.qrcodeurl:e.qrcodeurl="http://localhost:9090/images/qrcode.png",e.profileMsg=s.data.message},s=>{s.response?e.profileMsg=s.response.data.message:e.profileMsg=s.message,window.setTimeout(()=>{e.profileMsg=""},3e3)})}C(()=>{const a=sessionStorage.getItem("USERID");a!==null?e.userId=a:e.userId="";const s=sessionStorage.getItem("TOKEN");s!==null?e.token=s:e.token="",i("#cpwd").hide(),i("#mfa1").hide(),i("#mfa2").hide(),w(a)});async function h(a){a.preventDefault(),e.profileMsg="please wait...";const s=JSON.stringify({lastname:e.lastname,firstname:e.firstname,mobile:e.mobile});await n.patch(`/api/updateprofile/${e.userId}`,s,{headers:{Authorization:`Bearer ${e.token}`}}).then(t=>{e.profileMsg=t.data.message,window.setTimeout(()=>{e.profileMsg=""},3e3)},t=>{t.response?e.profileMsg=t.response.data.message:e.profileMsg=t.message,window.setTimeout(()=>{e.profileMsg=""},3e3)})}function b(){i("#changepwd").is(":checked")?(i("#cpwd").show(),i("#mfa1").hide(),i("#mfa2").hide(),i("#twofactor").prop("checked",!1),e.showSave=!0):(i("#cpwd").hide(),e.password="",e.confpassword="",e.showSave=!1)}function M(){i("#twofactor").is(":checked")?(i("#cpwd").hide(),i("#mfa1").show(),i("#mfa2").show(),i("#changepwd").prop("checked",!1),e.showSave=!0):(i("#mfa1").hide(),i("#mfa2").hide(),e.showSave=!1)}async function v(a){a.preventDefault();const s=JSON.stringify({TwoFactorEnabled:!0});await n.patch(`/api/mfa/activate/${e.userId}`,s,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.token}`}}).then(t=>{e.profileMsg=t.data.message,window.setTimeout(()=>{e.qrcodeurl=t.data.qrcodeurl,e.profileMsg=""},3e3)},t=>{t.response?e.profileMsg=t.response.data.message:e.profileMsg=t.message,window.setTimeout(()=>{e.profileMsg=""},3e3)})}async function _(a){if(a.preventDefault(),e.password===""){e.profileMsg="Please enter new password.",window.setTimeout(()=>{e.profileMsg="",e.qrcodeurl="/images/qrcode.png"},3e3);return}if(e.confpassword===""){e.profileMsg="Please confirm new password.",window.setTimeout(()=>{e.profileMsg=""},3e3);return}e.password!==""&&e.confpassword?e.password!==e.confpassword&&(e.profileMsg="New Password does not matched.",window.setTimeout(()=>{e.profileMsg=""},3e3)):(e.profileMsg="please enter password",window.setTimeout(()=>{e.profileMsg=""},3e3));const s=JSON.stringify({password:e.password});await n.patch(`/api/changepassword/${e.userId}`,s,{headers:{Authorization:`Bearer ${e.token}`}}).then(t=>{e.profileMsg=t.data.message,window.setTimeout(()=>{e.profileMsg=""},3e3)},t=>{t.response?e.profileMsg=t.response.data.message:e.profileMsg=t.message,window.setTimeout(()=>{e.profileMsg=""},3e3)})}async function y(a){a.preventDefault();const s=JSON.stringify({TwoFactorEnabled:!1});await n.patch(`/api/mfa/activate/${e.userId}`,s,{headers:{Authorization:`Bearer ${e.token}`}}).then(t=>{e.profileMsg=t.data.message,window.setTimeout(()=>{e.qrcodeurl="http://localhost:9090/images/qrcode.png",e.profileMsg=""},3e3)},t=>{t.response?e.profileMsg=t.response.data.message:e.profileMsg=t.message,window.setTimeout(()=>{e.profileMsg=""},3e3)})}async function k(a){i("#pix").attr("src",URL.createObjectURL(a.target.files[0]));const s=a.target.files[0];new FormData().append("myImage",s);const c=a.target;if(c.files&&c.files.length>0&&(f.value=c.files[0],i("#userpic").attr("src",URL.createObjectURL(f.value))),f.value){let m=new FormData;m.append("userpic",c.files[0]),await n.patch(`/api/uploadpicture/${e.userId}`,m,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${e.token}`}}).then(l=>{e.profileMsg=l.data.message,window.setTimeout(()=>{sessionStorage.setItem("USERPIC",`http://localhost:9090/users/${l.data.userpic}`),e.profileMsg="",window.location.reload()},3e3)},l=>{l.response?e.profileMsg=l.response.data.message:e.profileMsg=l.message,window.setTimeout(()=>{e.profileMsg=""},3e3)})}}return(a,s)=>(g(),u("div",$,[o("div",U,[s[10]||(s[10]=o("div",{class:"card-header bg-success"},[o("h4",{class:"text-warning"},"USER PROFILE")],-1)),o("div",A,[o("form",N,[o("div",E,[o("div",B,[o("div",F,[r(o("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=t=>e.firstname=t),required:"",class:"form-control",placeholder:"enter First Name"},null,512),[[d,e.firstname]])]),o("div",O,[r(o("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=t=>e.lastname=t),required:"",class:"form-control",placeholder:"enter Last Name"},null,512),[[d,e.lastname]])]),o("div",R,[r(o("input",{type:"email","onUpdate:modelValue":s[2]||(s[2]=t=>e.email=t),class:"form-control",disabled:!0},null,512),[[d,e.email]])]),o("div",V,[r(o("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=t=>e.mobile=t),required:"",class:"form-control",placeholder:"enter Mobile No."},null,512),[[d,e.mobile]])])]),o("div",j,[o("div",L,[o("img",{id:"pix",class:"userpic",src:e.profilepic,alt:"profilepic"},null,8,z)]),o("div",J,[o("input",{onChange:k,class:"form-control form-control-sm",id:"userpic",type:"file",accept:".png, .jpg, .jpeg, .gif"},null,32)])])]),o("div",G,[o("div",K,[o("div",Q,[o("input",{onChange:b,class:"form-check-input check-box",type:"checkbox",value:"",id:"changepwd"},null,32),s[6]||(s[6]=o("label",{class:"form-check-label",for:"changepwd"}," Change Password ",-1))]),o("div",Y,[o("div",H,[r(o("input",{type:"password",required:"",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=t=>e.password=t),placeholder:"enter new Password",autocomplete:"off"},null,512),[[d,e.password]])]),o("div",W,[r(o("input",{type:"password",required:"",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=t=>e.confpassword=t),placeholder:"confirm new Password",autocomplete:"off"},null,512),[[d,e.confpassword]])]),o("button",{onClick:_,type:"button",class:"btn btn-primary"},"change password")]),o("div",X,[o("img",{class:"qrcode1",src:e.qrcodeurl,alt:"qrcodeurl"},null,8,Z)])]),o("div",ee,[o("div",se,[o("input",{onChange:M,class:"form-check-input check-box",type:"checkbox",value:"",id:"twofactor"},null,32),s[7]||(s[7]=o("label",{class:"form-check-label",for:"twofactor"}," 2-Factor Authenticator ",-1))]),o("div",{id:"mfa2"},[s[8]||(s[8]=o("p",{class:"text-danger"},[o("strong",null,"Requirements")],-1)),s[9]||(s[9]=o("p",null,[p("You need to install "),o("strong",null,"Google or Microsoft Authenticator"),p(" in your Mobile Phone, once installed, click Enable Button below, and "),o("strong",null,"SCAN QR CODE"),p(", next time you login, another dialog window will appear, then enter the "),o("strong",null,"OTP CODE"),p(" from your Mobile Phone in order for you to login.")],-1)),o("button",{onClick:v,type:"button",class:"btn btn-primary mx-1 mb-1"},"Enable"),o("button",{onClick:y,type:"button",class:"btn btn-secondary"},"Disable")])])]),e.showSave?S("",!0):(g(),u("div",oe,[o("button",{onClick:h,id:"save",type:"submit",class:"btn btn-success text-warning"},"save")]))])]),o("div",te,I(e.profileMsg),1)])]))}}),de=P(ae,[["__scopeId","data-v-b656bb12"]]);export{de as default};
